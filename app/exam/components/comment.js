import React, { useState } from 'react'
import styles from './comments.module.css'
import userIcon from '@/public/images/userIcon40px.svg'
import Image from 'next/image'

const Comment = () => {
  const [comments, setComments] = useState([])
  const [inputValue1, setInputValue1] = useState('')
  const [inputValue2, setInputValue2] = useState('')
  const [replyId, setReplyId] = useState(null)

  const handleKeyDown1 = (e) => {
    if (e.key === 'Enter') {
      addComment();
    }
  };
  const handleKeyDown2 = (e) => {
    if (e.key === 'Enter') {
      addReply();
    }
  };
  const addComment = () => {
    if (inputValue1.trim() !== '') {
      const newComment = {
        id: new Date().getTime(),
        text: inputValue1,
        date: new Date(),
        likes: 0,
        replies: []
      }
      setComments([newComment, ...comments])
      setInputValue1('')
    }
  }

  const addReply = () => {
    if (inputValue2.trim() !== '') {
      const updatedComments = comments.map(comment => {
        if (comment.id === replyId) {
          return {
            ...comment,
            replies: [...comment.replies, {
              text: inputValue2,
              date: new Date()
            }]
          }
        }
        return comment
      })
      setComments(updatedComments)
      setInputValue2('')
      setReplyId(null)
    }
  }

  const renderReplies = (replies) => {
    return (
      <ul >
        {replies.map((reply, index) => (
          <li key={index} className={styles.replyList}>
            <div className={styles.reply}>
            <div className={styles.replyAuthor}>
                <Image src={userIcon} className={styles.replyImage}></Image>
              </div>
              <div className={styles.rText}>
                <div className={styles.replyText}>{reply.text}</div>
                <div className={styles.replyDate}>{reply.date.toLocaleString()}
                </div>

              </div>
            </div>
            <div className={styles.replyMeta}>
                    <div className={styles.like1Icon}>
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.2101 4.19386L11.8837 3.8674L11.7469 3.73452C9.24241 1.37325 5.30679 1.42794 2.86733 3.8674C0.377558 6.35717 0.377558 10.394 2.86733 12.8837L11.8235 21.8399C11.926 21.9424 12.0651 22 12.2101 22C12.3551 22 12.4942 21.9424 12.5967 21.8399L21.5529 12.8837C24.0427 10.394 24.0427 6.35717 21.5529 3.8674C19.0631 1.37763 15.0263 1.37763 12.5366 3.8674L12.2101 4.19386ZM10.6128 4.91952L10.732 5.036L12.2101 6.51356L13.6964 5.02725C14.1361 4.58753 14.6581 4.23872 15.2326 4.00074C15.8071 3.76277 16.4229 3.64028 17.0447 3.64028C17.6666 3.64028 18.2823 3.76277 18.8568 4.00074C19.4313 4.23872 19.9534 4.58753 20.3931 5.02725L20.5019 5.1399C21.3415 6.03705 21.7994 7.22544 21.779 8.45401C21.7586 9.68257 21.2614 10.8551 20.3925 11.7239L12.2101 19.9063L4.02718 11.7239C3.15553 10.8545 2.65671 9.67991 2.63648 8.44902C2.61624 7.21812 3.07619 6.02774 3.91879 5.13022C4.7614 4.23271 5.92042 3.69865 7.15015 3.64124C8.37987 3.58384 9.58361 4.00762 10.5062 4.82273L10.6128 4.91952Z" fill="#6F614C" />
                      </svg>
                    </div>
                    <div className={styles.comment1Icon}>
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.3943 2C18.5796 2 19.7164 2.47087 20.5546 3.30903C21.3927 4.14719 21.8636 5.28398 21.8636 6.46931V15.1596C21.8636 16.345 21.3927 17.4818 20.5546 18.3199C19.7164 19.1581 18.5796 19.629 17.3943 19.629H14.8821L12.6067 21.7355C12.4231 21.9055 12.1821 22 11.9318 22C11.6816 22 11.4405 21.9055 11.2569 21.7355L8.98206 19.629H6.46931C5.28398 19.629 4.14719 19.1581 3.30903 18.3199C2.47087 17.4818 2 16.345 2 15.1596V6.46931C2 5.28398 2.47087 4.14719 3.30903 3.30903C4.14719 2.47087 5.28398 2 6.46931 2H17.3943ZM17.3943 3.48977H6.46931C5.67909 3.48977 4.92123 3.80369 4.36246 4.36246C3.80369 4.92123 3.48977 5.67909 3.48977 6.46931V15.1596C3.48977 15.9499 3.80369 16.7077 4.36246 17.2665C4.92123 17.8253 5.67909 18.1392 6.46931 18.1392H8.98156C9.35685 18.1392 9.71828 18.281 9.99361 18.536L11.9318 20.3301L13.87 18.536C14.1453 18.281 14.5068 18.1392 14.8821 18.1392H17.3943C18.1845 18.1392 18.9424 17.8253 19.5012 17.2665C20.0599 16.7077 20.3738 15.9499 20.3738 15.1596V6.46931C20.3738 5.67909 20.0599 4.92123 19.5012 4.36246C18.9424 3.80369 18.1845 3.48977 17.3943 3.48977ZM11.9318 9.44885C12.2693 9.44912 12.5928 9.5834 12.8313 9.82216C13.0698 10.0609 13.2037 10.3846 13.2036 10.7221C13.2037 11.0596 13.0698 11.3833 12.8313 11.6221C12.5928 11.8608 12.2693 11.9951 11.9318 11.9954C11.5943 11.9951 11.2708 11.8608 11.0323 11.6221C10.7938 11.3833 10.6599 11.0596 10.66 10.7221C10.6599 10.3846 10.7938 10.0609 11.0323 9.82216C11.2708 9.5834 11.5943 9.44912 11.9318 9.44885ZM7.35324 9.44885C7.69071 9.44912 8.01427 9.5834 8.25276 9.82216C8.49124 10.0609 8.62514 10.3846 8.62501 10.7221C8.62514 11.0595 8.49131 11.3831 8.25293 11.6219C8.01455 11.8606 7.69113 11.995 7.35374 11.9954C7.01627 11.9951 6.69272 11.8608 6.45423 11.6221C6.21574 11.3833 6.08184 11.0596 6.08197 10.7221C6.08184 10.3847 6.21567 10.0611 6.45405 9.82234C6.69243 9.58359 7.01586 9.44925 7.35324 9.44885ZM16.5104 9.44885C16.8478 9.44925 17.1712 9.58359 17.4096 9.82234C17.6479 10.0611 17.7818 10.3847 17.7816 10.7221C17.7818 11.0595 17.6479 11.3831 17.4096 11.6219C17.1712 11.8606 16.8478 11.995 16.5104 11.9954C16.1729 11.9951 15.8493 11.8608 15.6109 11.6221C15.3724 11.3833 15.2385 11.0596 15.2386 10.7221C15.2385 10.3847 15.3723 10.0611 15.6107 9.82234C15.8491 9.58359 16.1725 9.44925 16.5099 9.44885H16.5104Z" fill="#6F614C" />
                      </svg>
                    </div>
            </div>
          </li>
        ))}
      </ul>
    )
  }

  const renderComments = () => {
    return (
      <ul className={styles.commentList}>
        {comments.map((comment) => (
          <li key={comment.id} className={styles.commentItem} onClick={() => setReplyId(comment.id)}>
            <div className={styles.comment}>
              <div className={styles.commentAuthor}>
                <Image src={userIcon} className={styles.commentImage}></Image>
              </div>
              <div className={styles.cText}>
                <div className={styles.commentText}>{comment.text}</div>
                <span className={styles.comDate}>{comment.date.toLocaleString()}</span>
              </div>
            </div>
            <div className={styles.commentMeta}>
              <div className={styles.likeIcon}>
                <svg width="24" height="24" viewBox="0 2 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12.2101 4.19386L11.8837 3.8674L11.7469 3.73452C9.24241 1.37325 5.30679 1.42794 2.86733 3.8674C0.377558 6.35717 0.377558 10.394 2.86733 12.8837L11.8235 21.8399C11.926 21.9424 12.0651 22 12.2101 22C12.3551 22 12.4942 21.9424 12.5967 21.8399L21.5529 12.8837C24.0427 10.394 24.0427 6.35717 21.5529 3.8674C19.0631 1.37763 15.0263 1.37763 12.5366 3.8674L12.2101 4.19386ZM10.6128 4.91952L10.732 5.036L12.2101 6.51356L13.6964 5.02725C14.1361 4.58753 14.6581 4.23872 15.2326 4.00074C15.8071 3.76277 16.4229 3.64028 17.0447 3.64028C17.6666 3.64028 18.2823 3.76277 18.8568 4.00074C19.4313 4.23872 19.9534 4.58753 20.3931 5.02725L20.5019 5.1399C21.3415 6.03705 21.7994 7.22544 21.779 8.45401C21.7586 9.68257 21.2614 10.8551 20.3925 11.7239L12.2101 19.9063L4.02718 11.7239C3.15553 10.8545 2.65671 9.67991 2.63648 8.44902C2.61624 7.21812 3.07619 6.02774 3.91879 5.13022C4.7614 4.23271 5.92042 3.69865 7.15015 3.64124C8.37987 3.58384 9.58361 4.00762 10.5062 4.82273L10.6128 4.91952Z" fill="#A54136" />
                </svg>
              </div>
              <div className={styles.commentIcon}>
                <svg width="24" height="24" viewBox="0 2 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.3943 2C18.5796 2 19.7164 2.47087 20.5546 3.30903C21.3927 4.14719 21.8636 5.28398 21.8636 6.46931V15.1596C21.8636 16.345 21.3927 17.4818 20.5546 18.3199C19.7164 19.1581 18.5796 19.629 17.3943 19.629H14.8821L12.6067 21.7355C12.4231 21.9055 12.1821 22 11.9318 22C11.6816 22 11.4405 21.9055 11.2569 21.7355L8.98206 19.629H6.46931C5.28398 19.629 4.14719 19.1581 3.30903 18.3199C2.47087 17.4818 2 16.345 2 15.1596V6.46931C2 5.28398 2.47087 4.14719 3.30903 3.30903C4.14719 2.47087 5.28398 2 6.46931 2H17.3943ZM17.3943 3.48977H6.46931C5.67909 3.48977 4.92123 3.80369 4.36246 4.36246C3.80369 4.92123 3.48977 5.67909 3.48977 6.46931V15.1596C3.48977 15.9499 3.80369 16.7077 4.36246 17.2665C4.92123 17.8253 5.67909 18.1392 6.46931 18.1392H8.98156C9.35685 18.1392 9.71828 18.281 9.99361 18.536L11.9318 20.3301L13.87 18.536C14.1453 18.281 14.5068 18.1392 14.8821 18.1392H17.3943C18.1845 18.1392 18.9424 17.8253 19.5012 17.2665C20.0599 16.7077 20.3738 15.9499 20.3738 15.1596V6.46931C20.3738 5.67909 20.0599 4.92123 19.5012 4.36246C18.9424 3.80369 18.1845 3.48977 17.3943 3.48977ZM11.9318 9.44885C12.2693 9.44912 12.5928 9.5834 12.8313 9.82216C13.0698 10.0609 13.2037 10.3846 13.2036 10.7221C13.2037 11.0596 13.0698 11.3833 12.8313 11.6221C12.5928 11.8608 12.2693 11.9951 11.9318 11.9954C11.5943 11.9951 11.2708 11.8608 11.0323 11.6221C10.7938 11.3833 10.6599 11.0596 10.66 10.7221C10.6599 10.3846 10.7938 10.0609 11.0323 9.82216C11.2708 9.5834 11.5943 9.44912 11.9318 9.44885ZM7.35324 9.44885C7.69071 9.44912 8.01427 9.5834 8.25276 9.82216C8.49124 10.0609 8.62514 10.3846 8.62501 10.7221C8.62514 11.0595 8.49131 11.3831 8.25293 11.6219C8.01455 11.8606 7.69113 11.995 7.35374 11.9954C7.01627 11.9951 6.69272 11.8608 6.45423 11.6221C6.21574 11.3833 6.08184 11.0596 6.08197 10.7221C6.08184 10.3847 6.21567 10.0611 6.45405 9.82234C6.69243 9.58359 7.01586 9.44925 7.35324 9.44885ZM16.5104 9.44885C16.8478 9.44925 17.1712 9.58359 17.4096 9.82234C17.6479 10.0611 17.7818 10.3847 17.7816 10.7221C17.7818 11.0595 17.6479 11.3831 17.4096 11.6219C17.1712 11.8606 16.8478 11.995 16.5104 11.9954C16.1729 11.9951 15.8493 11.8608 15.6109 11.6221C15.3724 11.3833 15.2385 11.0596 15.2386 10.7221C15.2385 10.3847 15.3723 10.0611 15.6107 9.82234C15.8491 9.58359 16.1725 9.44925 16.5099 9.44885H16.5104Z" fill="#A54136" />
                </svg>

              </div>
              <div className={styles.comm}>{comment.replies.length}</div>
            </div>
            {renderReplies(comment.replies)}
            {replyId === comment.id && (
              <div className={styles.replyInputContainer}>
                <input
                  type="text"
                  value={inputValue2}
                  onChange={(e) => setInputValue2(e.target.value)}
                  placeholder="Write a reply..."
                  className={styles.input}
                  onKeyDown={handleKeyDown2}
                />
                <button onClick={addReply}>Send</button>
              </div>
            )}
            <div style={{height:15+'px'}}></div>
            <hr className={styles.line} />
          </li>
        ))}
      </ul>
    )
  }

  return (
    <div className={styles.commentBox}>
      <div className={styles.commentTit}>Comments</div>
      <div className={styles.commentContainer}>
        {renderComments()}
      </div>
      <div className={styles.inputContainer}>
        {/* <div className={styles.pageCounter}>
          <svg width="72" height="28" viewBox="0 0 72 28" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0.25" y="0.25" width="27.5" height="27.5" rx="5.75" stroke="#6F614C" stroke-width="0.5" />
            <rect x="44.25" y="0.25" width="27.5" height="27.5" rx="5.75" stroke="#6F614C" stroke-width="0.5" />
            <path opacity="0.5" d="M0 22H28C28 25.3137 25.3137 28 22 28H6C2.68629 28 0 25.3137 0 22Z" fill="#6F614C" />
            <path d="M15.7043 19.5H13.6243V10.348L11.3043 12.364V10.124L13.6243 8.108H15.7043V19.5Z" fill="#6F614C" />
            <path d="M61.5283 19.5H54.6003V17.628L58.8563 12.684C59.2509 12.2253 59.4483 11.7667 59.4483 11.308C59.4483 10.8813 59.3256 10.54 59.0803 10.284C58.8456 10.0173 58.5096 9.884 58.0723 9.884C57.1443 9.884 56.6803 10.3693 56.6803 11.34H54.6003C54.6003 10.3267 54.9363 9.51067 55.6083 8.892C56.2483 8.30533 57.0696 8.012 58.0723 8.012C59.0963 8.012 59.9283 8.31067 60.5683 8.908C61.2083 9.50533 61.5283 10.3107 61.5283 11.324C61.5283 11.836 61.4216 12.2947 61.2083 12.7C61.0589 13.0093 60.7603 13.42 60.3123 13.932L57.1283 17.628H61.5283V19.5Z" fill="#6F614C" />
          </svg>
        </div> */}
        <div className={styles.commentInputContainer}>
          <input
            type="text"
            value={inputValue1}
            onChange={(e) => setInputValue1(e.target.value)}
            placeholder="click to comment"
            className={styles.input}
            onKeyDown={handleKeyDown1}
          />
          <button onClick={addComment} className={styles.sendBtn}>Send</button>
        </div>
      </div>
    </div>
  )
}

export default Comment
